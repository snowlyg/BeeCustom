layui.define(["layer","table"],function(e){var s=layui.jquery,l=layui.layer,r=layui.table,c={render:function(t){c.checkParam(t)&&(t.data?c.init(t,t.data):s.getJSON(t.url,t.where,function(e){c.init(t,e.data)}))},init:function(o,e){for(var d=[],a=o.done,t=e,i=0;i<t.length;i++){var n=t[i];if(!n.id){if(!o.treeIdName)return void l.msg("参数treeIdName不能为空",{icon:5});n.id=n[o.treeIdName]}if(!n.pid){if(!o.treePidName)return void l.msg("参数treePidName不能为空",{icon:5});n.pid=n[o.treePidName]}}!function e(t,i){for(var a=0;a<i.length;a++)if(i[a].pid==t){var n=d.length;0<n&&d[n-1].id==t&&(d[n-1].isParent=!0),d.push(i[a]),e(i[a].id,i)}}(o.treeSpid,t),o.url=void 0,o.data=d,o.page={count:o.data.length,limit:o.data.length},o.cols[0][o.treeColIndex].templet=function(e){for(var t=e.id,i=e.pid,a=e.isParent,n=c.getEmptyNum(i,d),l="",r=0;r<n;r++)l+='<span class="treeTable-empty"></span>';return l+=a?'<i class="layui-icon layui-icon-triangle-d"></i> <i class="layui-icon layui-icon-layer"></i>':'<i class="layui-icon layui-icon-file"></i>','<span class="treeTable-icon open" lay-tid="'+t+'" lay-tpid="'+i+'" lay-ttype="'+(a?"dir":"file")+'">'+(l+="&nbsp;&nbsp;")+e[o.cols[0][o.treeColIndex].field]+"</span>"},o.done=function(e,t,i){s(o.elem).next().addClass("treeTable"),s(".treeTable .layui-table-page").css("display","none"),s(o.elem).next().attr("treeLinkage",o.treeLinkage),o.treeDefaultClose&&c.foldAll(o.elem),a&&a(e,t,i)},r.render(o)},getEmptyNum:function(e,t){var i,a=0;if(!e)return a;for(var n=0;n<t.length;n++)if(e==t[n].id){a+=1,i=t[n].pid;break}return a+c.getEmptyNum(i,t)},toggleRows:function(e,n){if("file"!=e.attr("lay-ttype")){var l=e.attr("lay-tid"),r=e.hasClass("open");r?e.removeClass("open"):e.addClass("open"),e.closest("tbody").find("tr").each(function(){var e=s(this).find(".treeTable-icon"),t=e.attr("lay-tpid"),i=e.attr("lay-ttype"),a=e.hasClass("open");l==t&&(r?(s(this).hide(),"dir"==i&&a==r&&e.trigger("click")):(s(this).show(),n&&"dir"==i&&a==r&&e.trigger("click")))})}},checkParam:function(e){return e.treeSpid||0==e.treeSpid?!(!e.treeColIndex&&0!=e.treeColIndex)||(l.msg("参数treeColIndex不能为空",{icon:5}),!1):(l.msg("参数treeSpid不能为空",{icon:5}),!1)},expandAll:function(e){s(e).next(".treeTable").find(".layui-table-body tbody tr").each(function(){var e=s(this).find(".treeTable-icon"),t=e.attr("lay-ttype"),i=e.hasClass("open");"dir"!=t||i||e.trigger("click")})},foldAll:function(e){s(e).next(".treeTable").find(".layui-table-body tbody tr").each(function(){var e=s(this).find(".treeTable-icon"),t=e.attr("lay-ttype"),i=e.hasClass("open");"dir"==t&&i&&e.trigger("click")})}};layui.link(layui.cache.base+"treetable-lay/treetable.css"),s("body").on("click",".treeTable .treeTable-icon",function(){"true"==s(this).parents(".treeTable").attr("treeLinkage")?c.toggleRows(s(this),!0):c.toggleRows(s(this),!1)}),e("treetable",c)});