!function(n){n.fn.extend({AutoComplete:function(t){return this.each(function(){this&&"INPUT"===this.tagName&&"text"===this.type&&(this.controller?this.controller.setOption(t):n.isPlainObject(t)&&(this.controller=new i(this,t)))})}});function e(t){"up"===this.option.listDirection&&(t=t.reverse());try{(function(t){var s=this,o=this.searchView.find("ul").empty();if(-1==n.inArray(this.option.listStyle,["normal","iconList","custom"]))throw["遇到未知的listStyle参数！"];n.each(t,function(t,i){var e=n("<li><div></div></li>").appendTo(o).addClass(s.option.listStyle).data("data",i).find("div");switch(s.option.listStyle){case"normal":e.append("<span>"+i.label+"</span>");break;case"iconList":var a=n("<img></img>").attr("src",i.image);e.append(n("<div></div>").append(a)).append("<span>"+i.label+"</span>");break;case"custom":e.append(s.option.createItemHandler.apply(s,[t,i]))}0<s.option.itemHeight&&e.height(s.option.itemHeight).css("max-height",s.option.itemHeight)})}).apply(this,[t]),0<this.option.maxHeight&&(this.searchView.css("max-height",this.option.maxHeight+"px"),n.browser.msie&&this.searchView.css("height",this.searchView.height()>this.option.maxHeight?this.option.maxHeight+"px":"auto")),o.apply(this),this.searchView.css("width",function(){if("string"==typeof this.option.width&&"auto"===this.option.width.toLowerCase())return this.inputView.outerWidth()-2;if("number"==typeof this.option.width)return this.option.width;throw"遇到未知的width参数！"}.apply(this)+"px")}catch(t){return void c.apply(this,[t+""])}this.searchView.show(),h.apply(this,[this.option.listDirection])}var i=function(t,i){this.option=n.extend(!1,{width:320,maxHeight:null,itemHeight:null,listStyle:"normal",listDirection:"down",data:[],ajaxDataType:"json",ajaxParams:{},ajaxTimeout:3e3,ajaxType:"GET",maxItems:20,matchHandler:u,emphasisHandler:d,createItemHandler:null,beforeLoadDataHandler:null,afterSelectedHandler:null,async:!1,emphasis:!0,onerror:null},i),a.apply(this,[t]),s.apply(this)},a=function(t){var e=this;this.inputView=n(t);var i=!0;this.inputView.attr("autocomplete","off").on("compositionstart",this._compositionstart=function(){i=!1}).on("compositionend",this._compositionend=function(){i=!0}).keyup(this._keyup=function(t){switch(t.keyCode){case 13:case 16:case 17:case 37:case 38:case 39:case 40:break;case 27:p.apply(e);break;default:e.option.async?setTimeout(function(){i&&l.apply(e)},0):i&&l.apply(e)}}).keydown(this._keydown=function(t){switch(t.keyCode){case 38:h.apply(e,["up"]);break;case 40:h.apply(e,["down"]);break;case 13:var i=e.searchView.is(":visible");if(r.apply(e),i)return!1}}).blur(this._blur=function(){n(document).one("click",function(){p.apply(e)}),r.apply(e)})},s=function(){var t=this;this.searchView=n("<div class='ac'><ul></ul></div>").appendTo(document.body).on("mouseenter","li",function(){t.searchView.find("li.selected").removeClass("selected"),n(this).addClass("selected")}).on("mouseleave","li",function(){}).on("click","li",function(){r.apply(t),p.apply(t)}).css("font-size",this.inputView.css("font-size")),n(window).resize(function(){o.apply(t)})},o=function(){if("down"===this.option.listDirection)var t=this.inputView.offset().top+this.inputView.outerHeight();else{if("up"!==this.option.listDirection)throw"遇到未知的listDirection参数！";t=this.inputView.offset().top-this.searchView.outerHeight()}var i=this.inputView.offset().left;this.searchView.css("top",t+"px").css("left",i+"px")},p=function(){this.searchView.find("ul").empty(),this.searchView.hide()},h=function(t){var i=this.searchView.find("li.selected");if(i.size())var e="up"===t?i.prev():i.next();else e="up"===t?this.searchView.find("li").last():this.searchView.find("li").first();if(e.size()){this.searchView.find("li").removeClass("selected"),e.addClass("selected");var a=e.outerHeight(),s=e.position().top;a+s>this.searchView.height()?this.searchView.scrollTop(this.searchView.scrollTop()+s+a-this.searchView.height()):s<0&&this.searchView.scrollTop(this.searchView.scrollTop()+s)}},r=function(){var t=this.searchView.find("li.selected");if(t.size()){var i=t.data("data");if(this.inputView.val(i.value),n.isFunction(this.option.afterSelectedHandler))try{this.option.afterSelectedHandler.apply(this,[i])}catch(t){return void c.apply(this,["调用afterSelectedHandler错误:"+t])}p.apply(this)}},l=function(){var a=this,s=this.inputView.val(),t=[],i=!0,o=[];if(n.isFunction(this.option.beforeLoadDataHandler))try{i=this.option.beforeLoadDataHandler.apply(this,[s])}catch(t){return void c.apply(this,["调用beforeLoadDataHandler错误:"+t])}if(i)if(n.isArray(this.option.data))t=this.option.data;else if(n.isFunction(this.option.data))try{t=this.option.data.apply(this,[s])}catch(t){return void c.apply(this,["调用data错误:"+t])}else{if("string"!=typeof this.option.data)return void c.apply(this,["遇到未知的data参数！"]);try{t=function(t){layui.$.support.cors=!0;var i=this,s=[],e={async:!1,dataType:i.option.ajaxDataType,type:i.option.ajaxType,timeout:this.option.ajaxTimeout,success:function(t){if("xml"===i.option.ajaxDataType)n(t).find("item").each(function(){for(var t={value:n(this).text(),label:n(this).text()},i=0;i<this.attributes.length;i++){var e=this.attributes[i].nodeName,a=this.attributes[i].nodeValue;t[e]=a}s.push(t)});else{if("json"!==i.option.ajaxDataType)throw"遇到未知的ajaxDataType参数！";s=t}},error:function(t,i,e){throw e}};if(n.isPlainObject(this.option.ajaxParams))e.data=n.extend(!1,{keyword:t},this.option.ajaxParams);else if(n.isFunction(this.option.ajaxParams))e.data=n.extend(!1,{keyword:t},this.option.ajaxParams.apply(this,[t]));else{if("string"!=typeof this.option.ajaxParams)throw"遇到未知的ajaxParams参数！";e.data="keyword="+t+"&"+this.option.ajaxParams}return n.ajax(this.option.data,e),s}.apply(this,[s])}catch(t){return void c.apply(this,["Ajax错误:"+t])}}n.each(t,function(t,i){if(0<a.option.maxItems&&o.length>=a.option.maxItems)return!1;if(n.isPlainObject(i))var e=n.extend(!1,{},i);else{if("string"!=typeof i)return c.apply(a,["数据源Item类型错误！"]),!1;e={label:i,value:i,image:i}}a.option.matchHandler.apply(a,[s,e])&&o.push(e)}),s==this.inputView.val()&&(0<o.length?e.apply(this,[o]):(p.apply(this),layer.msg("无匹配数据",{icon:5,time:500}),layui.$(this.inputView[0]).val("")))},c=function(t){n.isFunction(this.option.onerror)&&this.option.onerror.apply(this,[t])};i.prototype.setOption=function(t){if(n.isPlainObject(t))this.option=n.extend(!1,this.option,t);else{if("string"!=typeof t)return void c.apply(this,["未知的AutoComplete参数类型！"]);switch(t){case"destroy":this.destroy();break;case"show":this.show();break;default:return void c.apply(this,["未知的AutoComplete参数！"])}}},i.prototype.destroy=function(){this.searchView.remove(),this.inputView.unbind("keyup",this._keyup).unbind("keydown",this._keydown).unbind("blur",this._blur),delete this.inputView.get(0).controller},i.prototype.show=function(){this.option.async?setTimeout(function(){l.apply(this)},0):l.apply(this)};var u=function(t,i){if(t.trim()){var e=RegExp(t.trim().replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"i");this.option.emphasis&&n.isFunction(this.option.emphasisHandler)&&this.option.emphasisHandler.apply(this,[t,i]);var a=i.label.replace(/<[^>]+>|&[^>]+;/g,"").trim();return e.test(a)}return!0},d=function(){}}(layui.$),layui.define(function(t){t("AutoComplete",layui.$.AutoComplete)});